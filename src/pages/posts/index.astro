---
import Layout from "../../layout/Layout.astro";

type Post = {
    slug: string;
    title: string;
    date: string;
};

const modules = import.meta.glob<{
    frontmatter: { title: string; date: string };
}>("/src/content/posts/*.md", { eager: true });

const posts: Post[] = Object.entries(modules)
    .map(([path, mod]) => {
        const fileName = path.split("/").pop()!;
        const slug = fileName.replace(/\.md$/, "");

        return {
            slug,
            title: mod.frontmatter.title,
            date: mod.frontmatter.date,
        };
    })
    .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<Layout title="Posts">
    <section class="py-8">
        <h1 class="text-white font-bold text-3xl">Posts</h1>
        <p class="text-gray-400 mt-2">Browse all blog posts.</p>

        <div class="mt-8 grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {
                posts.map((p) => (
                    <a
                        href={`/posts/${p.slug}`}
                        class="group block rounded-xl border border-gray-800 bg-gray-900/70 p-5 transition hover:-translate-y-1 hover:border-indigo-400 hover:shadow-lg hover:shadow-indigo-500/10"
                    >
                        <p class="text-sm text-gray-400">
                            {new Date(p.date).toLocaleDateString()}
                        </p>
                        <h2 class="mt-3 text-lg font-semibold text-gray-100 group-hover:text-indigo-300 transition">
                            {p.title}
                        </h2>
                        <p class="mt-4 text-sm text-indigo-300">Read post -></p>
                    </a>
                ))
            }
        </div>
    </section>
</Layout>
